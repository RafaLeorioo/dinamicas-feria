const activities = [
  {
    title: "Eco del cuento",
    material: ["Bochi + Pochi i l’ocell", "Besitos", "Como tú, como yo"],
    ages: ["1º", "2º", "3º", "4º"],
    duration: 5,
    people: "1 o 2 feriantes",
    maxStudents: 100,
    visit: "15 min (5' + 10')",
    description: "Lectura teatralizada donde el alumnado repite la última palabra en forma de eco. En 'Como tú, como yo' se repiten las palabras en mayúsculas de cada página.",
    moreInfo: `<strong>Desarrollo de la actividad</strong><br><br>
La persona dinamizadora inicia la lectura del cuento elegido, poniendo especial énfasis en determinadas palabras clave.<br><br>
La dinámica consiste en que las criaturas repitan en forma de “eco” la última palabra que dice la persona dinamizadora, justo después de que esta haga una pequeña pausa.<br><br>
En el cuento <em>Como tú, como yo</em>, cada página contiene una palabra escrita en mayúsculas. La persona dinamizadora deberá leerla, detenerse y permitir que las criaturas la repitan en voz alta.<br><br>
La clave está en realizarlo de manera muy teatralizada: variando la voz, el volumen, el ritmo y la intención para mantener la atención del grupo y generar un ambiente dinámico y divertido.`
  },
  {
    title: "Cuento congelado",
    material: ["El primer libro de las emociones", "Mis manos"],
    ages: ["Infantil", "1º", "2º"],
    duration: 7,
    people: "1 o 2 feriantes",
    maxStudents: 50,
    visit: "20 min (7' + 13')",
    description: "Mientras se narra el cuento se mueven libremente. Cuando la narración se detiene, todos se congelan. Variante: representar emociones cuando aparecen en el cuento.",
    moreInfo: `<strong>Desarrollo de la actividad</strong><br><br>
Las niñas y niños se colocan de pie dentro del espacio delimitado, recordando que no deben salir de él.<br><br>
Mientras la persona dinamizadora narra un cuento, pueden moverse libremente. Cuando la lectura se detenga, todas las criaturas —incluida la persona que guía— deben quedarse completamente congeladas hasta que la narración continúe.<br><br>
<strong>Variante con El primer libro de las emociones</strong><br><br>
En esta versión, la persona dinamizadora se detiene cada vez que en el cuento aparece una emoción. En ese momento, todos deben congelarse e interpretar corporal y facialmente esa emoción.<br><br>
Ejemplo:<br>
Si se lee “… alegría” y se hace una pausa, las criaturas deben mostrar una expresión de alegría. Si luego aparece “miedo”, se repite el proceso mostrando esa emoción. La dinámica continúa así hasta el final del cuento.`
  },
  {
    title: "Finales locos",
    material: ["Ninguno"],
    ages: ["4º", "5º", "6º"],
    duration: 15,
    people: "2 feriantes",
    maxStudents: 50,
    visit: "30 min (15' + 15')",
    description: "Se cuenta un cuento clásico con huecos que el alumnado completa con ideas absurdas. Favorece creatividad y participación.",
    moreInfo: `<strong>Desarrollo de la actividad</strong><br><br>
“Finales Locos” es una dinámica donde se cuenta un cuento clásico y el alumnado lo transforma con ideas disparatadas. Favorece creatividad y participación.<br><br>
<strong>Inicio:</strong><br>
Con un tono cercano (no infantil), el dinamizador/a explica: “Contaré un cuento conocido y vosotros completaréis los huecos con ideas locas.” (Mejor en círculo). Podemos usar cuentos presentes en la feria.<br><br>
Se anuncia el cuento, se narra haciendo pausas y cada alumno aporta una palabra u ocurrencia. El dinamizador/a la integra y continúa.<br><br>
Ejemplo:<br>
“Caperucita vivía con su… (pausa)” → perro<br>
“El perro se llamaba… (pausa)” → Eustaquio<br><br>
El dinamizador/a mantiene ritmo, humor y cohesión.<br><br>
• Los detalles absurdos funcionan con los grupos más mayores.<br>
• Mantén humor y agilidad<br>
• Evita censurar ideas`
  },
  {
    title: "Preguntas y respuestas",
    material: ["Tarjetas con preguntas"],
    ages: ["4º", "5º", "6º"],
    duration: 10,
    people: "2 feriantes",
    maxStudents: 100,
    visit: "15 min (5' + 10')",
    description: "Juego de preguntas por categorías: personajes, títulos y vocabulario. Posibilidad de rebote si fallan.",
    moreInfo: `<strong>Desarrollo de la actividad</strong><br><br>
Proponemos al grupo jugar a un juego de preguntas y respuestas literarias.<br><br>
Dispondremos de varias tarjetas clasificadas en tres categorías: PERSONAJES, TÍTULOS y VOCABULARIO.<br><br>
Iremos lanzando preguntas de las distintas categorías y, en función del tiempo disponible, podremos formular más o menos ítems.<br><br>
El alumnado deberá levantar la mano para pedir turno antes de responder.<br><br>
Además, podemos incorporar la opción de “rebote”: si una persona da una respuesta incorrecta, otra compañera u otro compañero podrá intentar responderla.`
  },
  {
    title: "Cuento invisible",
    material: ["Ninguno"],
    ages: ["Infantil"],
    duration: 3,
    people: "1 feriante",
    maxStudents: 100,
    visit: "15 min (5' + 10')",
    description: "Se inventa un cuento haciendo preguntas al grupo para construirlo juntos, conectándolo con libros reales de la feria.",
    moreInfo: `<strong>Desarrollo de la actividad</strong><br><br>
Nos colocamos delante del grupo y nos sentamos con ellos/as. Comenzamos a narrar una historia imaginaria, haciéndoles preguntas e invitándoles a participar:<br><br>
“¿Sabéis qué es esto?” (hacemos como si estuviéramos enseñando un cuento).<br>
“Es un cuento… ¿cómo es, grande o pequeño?”<br>
“¿De qué color es?”<br>
“¿Qué tiene en la portada?”<br>
“Cuenta la historia de ____ y ____.”<br><br>
Podemos aprovechar para enlazarlo con algún cuento de los que tengamos en la feria si la historia se asemeja a alguno, o incluso, intentar dirigir la historia para que el libro invisible sea alguno de la feria.<br><br>
De esta manera, les despertamos interés para que vayan a leerlo.`
  },
  {
    title: "¿Quién ganaría?",
    material: ["5 preguntas preparadas"],
    ages: ["3º", "4º", "5º", "6º"],
    duration: 10,
    people: "2 feriantes",
    maxStudents: 50,
    visit: "20 min (10' + 10')",
    description: "Se comparan dos personajes en diferentes pruebas. El grupo se mueve hacia el lado del personaje que creen que ganaría.",
    moreInfo: `<strong>Desarrollo de la actividad</strong><br><br>
Animamos al grupo a decir dos personajes de libros, personajes animados...<br><br>
Usaremos estos dos personajes para lanzarles preguntas con la premisa: “¿Quién ganaría…?”<br><br>
Por ejemplo, imaginemos que han elegido a Spiderman y un león. Las preguntas que podemos hacer serían:<br>
¿Quién ganaría en una competición de natación?<br>
¿Quién ganaría en una carrera de obstáculos?<br>
¿Quién ganaría encontrando un objeto escondido en el menor tiempo?<br>
¿Quién ganaría contando una historia divertida sin reírse?<br><br>
Como dinamizadores, marcamos que nuestra derecha corresponde a un personaje y nuestra izquierda al otro.<br><br>
En cada pregunta, el grupo deberá moverse hacia el lado del personaje que crean que ganaría.`
  },
  {
    title: "¿Qué preferirías?",
    material: ["5 situaciones preparadas"],
    ages: ["3º", "4º", "5º", "6º"],
    duration: 5,
    people: "1 feriante",
    maxStudents: 100,
    visit: "15 min (5' + 10')",
    description: "Elección entre dos opciones de personajes o situaciones, enlazando con libros disponibles en la feria.",
    moreInfo: `<strong>Desarrollo de la actividad</strong><br><br>
Una vez estamos con el grupo, les proponemos situaciones en las que tienen que elegir.<br><br>
Por ejemplo:<br>
¿Qué preferiríais: que en un duelo de magia ganase Harry Potter o Draco Malfoy?<br>
¿Qué preferiríais: que Sherlock Holmes resolviera un misterio en vuestro colegio o que lo resolviera la patrulla canina?<br>
¿Qué preferiríais: vivir una aventura con Gerónimo Stilton o con Alicia en el País de las Maravillas?<br><br>
Las últimas preguntas serán incluyendo personajes de los libros de la feria, del estilo:<br>
- ¿Qué preferiríais: que os entrenara para una misión LadyBug o Spiderman? - ¿Sabéis que en nuestra feria podéis encontrar mangas de ladybug y cómics de spiderman?<br>
- ¿Qué preferiríais: hacer una carrera contra un león o contra un dinosaurio? - Pues atentas y atentos, que también tenemos libros de animales y dinosaurios.<br>
- ¿Qué preferiríais: viajar a una isla tropical siendo un animal o una veterinaria? - Pues os invito/invitamos a que paséis a la feria del libro y que viajéis a través de todas las historias y libros que podéis encontrar en ella.`
  },
  {
    title: "El personaje secreto",
    material: ["Ninguno"],
    ages: ["1º", "2º", "3º", "4º", "5º", "6º"],
    duration: 3,
    people: "1 feriante",
    maxStudents: 100,
    visit: "15 min (3' + 12')",
    description: "Se dan pistas progresivas para adivinar un personaje de los libros de la feria.",
    moreInfo: `<strong>Desarrollo de la actividad</strong><br><br>
Pensaremos en un personaje de un libro de la feria, y vamos dando pistas progresivas al grupo hasta que adivinen de quién se trata.<br><br>
Por ejemplo, si pensamos en un dinosaurio, las pistas podrían ser: Animal, extinto y algunos eran gigantes y otros pequeñitos.<br><br>
Tienen que ir respondiendo, pidiendo el turno levantando su mano, hasta que acierten el personaje.<br><br>
“Si solo con unas pistas habéis podido imaginar un personaje… ¡Imaginad todo lo que podréis descubrir entre libros!`
  },
  {
    title: "Una palabra",
    material: ["Ninguno"],
    ages: ["1º", "2º", "3º", "4º", "5º", "6º"],
    duration: 3,
    people: "1 feriante",
    maxStudents: 100,
    visit: "15 min (3' + 12')",
    description: "Se dice un personaje y el alumnado responde con asociaciones rápidas de palabras.",
    moreInfo: `<strong>Desarrollo de la actividad</strong><br><br>
La persona dinamizadora prepara varios personajes conocidos por el alumnado (de cuentos, libros, series o dibujos). Los presenta en voz alta y con energía, por ejemplo: “¡Spiderman!”.<br><br>
El grupo levanta la mano y se elige a alguien para decir una asociación rápida (“araña”, “mayas”, “telarañas”). Se pueden repetir varias veces las asociaciones con un mismo personaje antes de cambiar a otro, como “¡Bluey!”, generando respuestas como “azul” o “perro”.<br><br>
Esta dinámica fomenta la atención, la rapidez mental, la participación y la asociación de ideas.<br><br>
<strong>Aspectos a considerar:</strong><br>
Adaptar los personajes a la edad del grupo (más infantiles para 1.º-2.º de Primaria y más variados para cursos mayores). La duración es flexible y depende del tiempo disponible y de la energía del grupo.`
  }
];

// ===== (El resto del código JavaScript sigue igual que en la versión anterior) =====

let selectedAge = null;
let selectedTime = null;
let selectedSize = null;
let selectedPeople = null;

const ageContainer = document.getElementById("ageButtons");
const timeContainer = document.getElementById("timeButtons");
const sizeContainer = document.getElementById("sizeButtons");
const peopleContainer = document.getElementById("peopleButtons");
const resetBtn = document.getElementById("resetBtn");
const cardsContainer = document.getElementById("activities");

// Modal
const modal = document.getElementById("modal");
const modalTitle = document.getElementById("modalTitle");
const modalBody = document.getElementById("modalBody");
const closeModal = document.querySelector(".close");

closeModal.onclick = () => modal.style.display = "none";
window.onclick = (e) => { if (e.target === modal) modal.style.display = "none"; };

// Función para activar solo un botón por grupo
function activateSingleButton(groupContainer, selectedVar, value, apply = true) {
  groupContainer.querySelectorAll("button").forEach(btn => btn.classList.remove("active"));
  if (selectedVar === value) {
    selectedVar = null; // Si se pulsa el mismo, se deselecciona
  } else {
    selectedVar = value;
    event.target.classList.add("active");
  }
  if (apply) applyFilters();
  return selectedVar;
}

// Botones (igual que antes)
const ageOptions = ["Infantil", "1º", "2º", "3º", "4º", "5º", "6º"];
const timeOptions = [{ label: "≤ 3 min", value: "short" }, { label: "4–7 min", value: "medium" }, { label: "8–15 min", value: "long" }];
const sizeOptions = [{ label: "Hasta 50", value: 50 }, { label: "Hasta 75", value: 75 }, { label: "Hasta 100", value: 100 }];
const peopleOptions = [{ label: "1 feriante", value: "1" }, { label: "2 feriantes", value: "2" }];

ageOptions.forEach(age => {
  const btn = document.createElement("button");
  btn.textContent = age;
  btn.onclick = (e) => { selectedAge = activateSingleButton(ageContainer, selectedAge, age); };
  ageContainer.appendChild(btn);
});

timeOptions.forEach(opt => {
  const btn = document.createElement("button");
  btn.textContent = opt.label;
  btn.onclick = (e) => { selectedTime = activateSingleButton(timeContainer, selectedTime, opt.value); };
  timeContainer.appendChild(btn);
});

sizeOptions.forEach(opt => {
  const btn = document.createElement("button");
  btn.textContent = opt.label;
  btn.onclick = (e) => { selectedSize = activateSingleButton(sizeContainer, selectedSize, opt.value); };
  sizeContainer.appendChild(btn);
});

peopleOptions.forEach(opt => {
  const btn = document.createElement("button");
  btn.textContent = opt.label;
  btn.onclick = (e) => { selectedPeople = activateSingleButton(peopleContainer, selectedPeople, opt.value); };
  peopleContainer.appendChild(btn);
});

resetBtn.onclick = () => {
  selectedAge = selectedTime = selectedSize = selectedPeople = null;
  document.querySelectorAll(".button-group button").forEach(b => b.classList.remove("active"));
  renderCards(activities);
};

// Render cards
function renderCards(list) {
  cardsContainer.innerHTML = "";
  if (!list.length) {
    cardsContainer.innerHTML = "<p>No hay dinámicas que cumplan los filtros.</p>";
    return;
  }

  list.forEach(a => {
    const card = document.createElement("div");
    card.className = "card";
    card.innerHTML = `
      <h2>${a.title}</h2>
      <p><span class="label">Material:</span> ${a.material.join(", ")}</p>
      <p><span class="label">Edad:</span> ${a.ages.join(", ")}</p>
      <p><span class="label">Duración:</span> ${a.duration} min</p>
      <p><span class="label">Personas:</span> ${a.people}</p>
      <p><span class="label">Máx. alumnos:</span> ${a.maxStudents}</p>
      <p><span class="label">Tiempo mínimo visita:</span> ${a.visit}</p>
      <p><span class="label">Desarrollo:</span> ${a.description}</p>
      <button class="more-info-btn">Más información</button>
    `;
    card.querySelector(".more-info-btn").onclick = () => openModal(a);
    cardsContainer.appendChild(card);
  });
}

function openModal(activity) {
  modalTitle.textContent = activity.title;
  modalBody.innerHTML = `
    <p><strong>Material:</strong> ${activity.material.join(", ")}</p>
    <p><strong>Edad:</strong> ${activity.ages.join(", ")}</p>
    <p><strong>Duración:</strong> ${activity.duration} min</p>
    <p><strong>Personas:</strong> ${activity.people}</p>
    <p><strong>Máx. alumnos:</strong> ${activity.maxStudents}</p>
    <p><strong>Tiempo mínimo visita:</strong> ${activity.visit}</p>
    <hr>
    ${activity.moreInfo}
  `;
  modal.style.display = "block";
}

// Filtrado (igual que antes)
function applyFilters() {
  let result = activities.filter(a => {

    if (selectedAge !== null && !a.ages.includes(selectedAge)) return false;

    if (selectedTime !== null) {
      const dur = a.duration;
      const matchTime = 
        (selectedTime === "short" && dur <= 3) ||
        (selectedTime === "medium" && dur >= 4 && dur <= 7) ||
        (selectedTime === "long" && dur >= 8);
      if (!matchTime) return false;
    }

    if (selectedSize !== null && a.maxStudents > selectedSize) return false;

    if (selectedPeople !== null) {
      const hasOne = a.people.includes("1");
      const hasTwo = a.people.includes("2");
      if (selectedPeople === "1" && !hasOne) return false;
      if (selectedPeople === "2" && !hasTwo) return false;
    }

    return true;
  });

  renderCards(result);
}

// Inicial
renderCards(activities);