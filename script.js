const activities = [
  {
    title: "Eco del cuento",
    material: ["Bochi + Pochi i l’ocell", "Besitos", "Como tú, como yo"],
    ages: ["1º", "2º", "3º", "4º"],
    duration: 5,
    people: "1 o 2 feriantes",
    maxStudents: 100,
    visit: "15 min (5' + 10')",
    fullDescription: `Desarrollo de la actividad
La persona dinamizadora inicia la lectura del cuento elegido, poniendo especial énfasis en determinadas palabras clave. La dinámica consiste en que las criaturas repitan en forma de “eco” la última palabra que dice la persona dinamizadora, justo después de que esta haga una pequeña pausa.
En el cuento Como tú, como yo, cada página contiene una palabra escrita en mayúsculas. La persona dinamizadora deberá leerla, detenerse y permitir que las criaturas la repitan en voz alta.
La clave está en realizarlo de manera muy teatralizada: variando la voz, el volumen, el ritmo y la intención para mantener la atención del grupo y generar un ambiente dinámico y divertido.`
  },
  {
    title: "Cuento congelado",
    material: ["El primer libro de las emociones", "Mis manos"],
    ages: ["Infantil", "1º", "2º"],
    duration: 7,
    people: "1 o 2 feriantes",
    maxStudents: 50,
    visit: "20 min (7' + 13')",
    fullDescription: `Desarrollo de la actividad
Las niñas y niños se colocan de pie dentro del espacio delimitado, recordando que no deben salir de él. Mientras la persona dinamizadora narra un cuento, pueden moverse libremente. Cuando la lectura se detenga, todas las criaturas —incluida la persona que guía— deben quedarse completamente congeladas hasta que la narración continúe.

Variante con El primer libro de las emociones
En esta versión, la persona dinamizadora se detiene cada vez que en el cuento aparece una emoción. En ese momento, todos deben congelarse e interpretar corporal y facialmente esa emoción.
Ejemplo: Si se lee “… alegría” y se hace una pausa, las criaturas deben mostrar una expresión de alegría. Si luego aparece “miedo”, se repite el proceso mostrando esa emoción. La dinámica continúa así hasta el final del cuento.`
  },
  {
    title: "Finales locos",
    material: ["Ninguno"],
    ages: ["4º", "5º", "6º"],
    duration: 15,
    people: "2 feriantes",
    maxStudents: 50,
    visit: "30 min (15' + 15')",
    fullDescription: `Desarrollo de la actividad
“Finales Locos” es una dinámica donde se cuenta un cuento clásico y el alumnado lo transforma con ideas disparatadas. Favorece creatividad y participación.

Inicio: Con un tono cercano (no infantil), el dinamizador/a explica: “Contaré un cuento conocido y vosotros completaréis los huecos con ideas locas.” (Mejor en círculo).
Podemos usar cuentos presentes en la feria. Se anuncia el cuento, se narra haciendo pausas y cada alumno aporta una palabra u ocurrencia. El dinamizador/a la integra y continúa.
Ejemplo: “Caperucita vivía con su… (pausa)” → perro “El perro se llamaba… (pausa)” → Eustaquio
El dinamizador/a mantiene ritmo, humor y cohesión.

* Los detalles absurdos funcionan con los grupos más mayores.
* Mantén humor y agilidad
* Evita censurar ideas`
  },
  {
    title: "Preguntas y respuestas",
    material: ["Tarjetas con preguntas"],
    ages: ["4º", "5º", "6º"],
    duration: 10,
    people: "2 feriantes",
    maxStudents: 100,
    visit: "15 min (5' + 10')",
    fullDescription: `Desarrollo de la actividad
Proponemos al grupo jugar a un juego de preguntas y respuestas literarias. Dispondremos de varias tarjetas clasificadas en tres categorías: PERSONAJES, TÍTULOS y VOCABULARIO.
Iremos lanzando preguntas de las distintas categorías y, en función del tiempo disponible, podremos formular más o menos ítems.
El alumnado deberá levantar la mano para pedir turno antes de responder. Además, podemos incorporar la opción de “rebote”: si una persona da una respuesta incorrecta, otra compañera u otro compañero podrá intentar responderla.`
  },
  {
    title: "Cuento invisible",
    material: ["Ninguno"],
    ages: ["Infantil"],
    duration: 3,
    people: "1 feriante",
    maxStudents: 100,
    visit: "15 min (5' + 10')",
    fullDescription: `Desarrollo de la actividad
Nos colocamos delante del grupo y nos sentamos con ellos/as. Comenzamos a narrar una historia imaginaria, haciéndoles preguntas e invitándoles a participar: “¿Sabéis qué es esto?” (hacemos como si estuviéramos enseñando un cuento). “Es un cuento… ¿cómo es, grande o pequeño?” “¿De qué color es?” “¿Qué tiene en la portada?” “Cuenta la historia de ____ y ____.”
Podemos aprovechar para enlazarlo con algún cuento de los que tengamos en la feria si la historia se asemeja a alguno, o incluso, intentar dirigir la historia para que el libro invisible sea alguno de la feria. De esta manera, les despertamos interés para que vayan a leerlo.`
  },
  {
    title: "¿Quién ganaría?",
    material: ["5 preguntas preparadas"],
    ages: ["3º", "4º", "5º", "6º"],
    duration: 10,
    people: "2 feriantes",
    maxStudents: 50,
    visit: "20 min (10' + 10')",
    fullDescription: `Desarrollo de la actividad
Animamos al grupo a decir dos personajes de libros, personajes animados... Usaremos estos dos personajes para lanzarles preguntas con la premisa: “¿Quién ganaría…?”
Por ejemplo, imaginemos que han elegido a Spiderman y un león. Las preguntas que podemos hacer serían:
¿Quién ganaría en una competición de natación?
¿Quién ganaría en una carrera de obstáculos?
¿Quién ganaría encontrando un objeto escondido en el menor tiempo?
¿Quién ganaría contando una historia divertida sin reírse?
Como dinamizadores, marcamos que nuestra derecha corresponde a un personaje y nuestra izquierda al otro. En cada pregunta, el grupo deberá moverse hacia el lado del personaje que crean que ganaría.`
  },
  {
    title: "¿Qué preferirías?",
    material: ["5 situaciones preparadas"],
    ages: ["3º", "4º", "5º", "6º"],
    duration: 5,
    people: "1 feriante",
    maxStudents: 100,
    visit: "15 min (5' + 10')",
    fullDescription: `Desarrollo de la actividad
Una vez estamos con el grupo, les proponemos situaciones en las que tienen que elegir. Por ejemplo:
¿Qué preferiríais: que en un duelo de magia ganase Harry Potter o Draco Malfoy?
¿Qué preferiríais: que Sherlock Holmes resolviera un misterio en vuestro colegio o que lo resolviera la patrulla canina?
¿Qué preferiríais: vivir una aventura con Gerónimo Stilton o con Alicia en el País de las Maravillas?
Las últimas preguntas serán incluyendo personajes de los libros de la feria, del estilo:

* ¿Qué preferiríais: que os entrenara para una misión LadyBug o Spiderman? - ¿Sabéis que en nuestra feria podéis encontrar mangas de ladybug y cómics de spiderman?
* ¿Qué preferiríais: hacer una carrera contra un león o contra un dinosaurio? - Pues atentas y atentos, que también tenemos libros de animales y dinosaurios.
* ¿Qué preferiríais: viajar a una isla tropical siendo un animal o una veterinaria? - Pues os invito/invitamos a que paséis a la feria del libro y que viajéis a través de todas las historias y libros que podéis encontrar en ella.`
  },
  {
    title: "El personaje secreto",
    material: ["Ninguno"],
    ages: ["1º", "2º", "3º", "4º", "5º", "6º"],
    duration: 3,
    people: "1 feriante",
    maxStudents: 100,
    visit: "15 min (3' + 12')",
    fullDescription: `Desarrollo de la actividad
Pensaremos en un personaje de un libro de la feria, y vamos dando pistas progresivas al grupo hasta que adivinen de quién se trata.
Por ejemplo, si pensamos en un dinosaurio, las pistas podrían ser: Animal, extinto y algunos eran gigantes y otros pequeñitos.
Tienen que ir respondiendo, pidiendo el turno levantando su mano, hasta que acierten el personaje.
“Si solo con unas pistas habéis podido imaginar un personaje… ¡Imaginad todo lo que podréis descubrir entre libros!”`
  },
  {
    title: "Una palabra",
    material: ["Ninguno"],
    ages: ["1º", "2º", "3º", "4º", "5º", "6º"],
    duration: 3,
    people: "1 feriante",
    maxStudents: 100,
    visit: "15 min (3' + 12')",
    fullDescription: `Desarrollo de la actividad
La persona dinamizadora prepara varios personajes conocidos por el alumnado (de cuentos, libros, series o dibujos). Los presenta en voz alta y con energía, por ejemplo: “¡Spiderman!”.
El grupo levanta la mano y se elige a alguien para decir una asociación rápida (“araña”, “mayas”, “telarañas”).
Se pueden repetir varias veces las asociaciones con un mismo personaje antes de cambiar a otro, como “¡Bluey!”, generando respuestas como “azul” o “perro”.
Esta dinámica fomenta la atención, la rapidez mental, la participación y la asociación de ideas.

Aspectos a considerar:
Adaptar los personajes a la edad del grupo (más infantiles para 1.º-2.º de Primaria y más variados para cursos mayores). La duración es flexible y depende del tiempo disponible y de la energía del grupo.`
  }
];

// ===== FILTROS =====

const ageOptions = ["Infantil", "1º", "2º", "3º", "4º", "5º", "6º"];

const timeOptions = [
  { label: "≤ 3 min", value: "short" },
  { label: "4–7 min", value: "medium" },
  { label: "8–15 min", value: "long" }
];

const sizeOptions = [
  { label: "Hasta 50", value: 50 },
  { label: "Hasta 75", value: 75 },
  { label: "Hasta 100", value: 100 }
];

const peopleOptions = [
  { label: "1 feriante", value: "1" },
  { label: "2 feriantes", value: "2" }
];

// Valores activos (solo uno por categoría)
let selectedAge = null;
let selectedTime = null;
let selectedSize = null;
let selectedPeople = null;

const ageContainer = document.getElementById("ageButtons");
const timeContainer = document.getElementById("timeButtons");
const sizeContainer = document.getElementById("sizeButtons");
const peopleContainer = document.getElementById("peopleButtons");
const resetBtn = document.getElementById("resetBtn");
const cardsContainer = document.getElementById("activities");
const modal = document.getElementById("modal");
const modalBody = document.getElementById("modal-body");
const closeModal = document.querySelector(".close");

// Función para desactivar todos los botones de un grupo
function deactivateGroup(container) {
  container.querySelectorAll("button").forEach(b => b.classList.remove("active"));
}

// Botones edad
ageOptions.forEach(age => {
  const btn = document.createElement("button");
  btn.textContent = age;
  btn.onclick = () => {
    deactivateGroup(ageContainer);
    btn.classList.add("active");
    selectedAge = age;
    applyFilters();
  };
  ageContainer.appendChild(btn);
});

// Botones duración
timeOptions.forEach(opt => {
  const btn = document.createElement("button");
  btn.textContent = opt.label;
  btn.onclick = () => {
    deactivateGroup(timeContainer);
    btn.classList.add("active");
    selectedTime = opt.value;
    applyFilters();
  };
  timeContainer.appendChild(btn);
});

// Botones alumnos
sizeOptions.forEach(opt => {
  const btn = document.createElement("button");
  btn.textContent = opt.label;
  btn.onclick = () => {
    deactivateGroup(sizeContainer);
    btn.classList.add("active");
    selectedSize = opt.value;
    applyFilters();
  };
  sizeContainer.appendChild(btn);
});

// Botones feriantes
peopleOptions.forEach(opt => {
  const btn = document.createElement("button");
  btn.textContent = opt.label;
  btn.onclick = () => {
    deactivateGroup(peopleContainer);
    btn.classList.add("active");
    selectedPeople = opt.value;
    applyFilters();
  };
  peopleContainer.appendChild(btn);
});

// Reset
resetBtn.onclick = () => {
  deactivateGroup(ageContainer);
  deactivateGroup(timeContainer);
  deactivateGroup(sizeContainer);
  deactivateGroup(peopleContainer);
  selectedAge = selectedTime = selectedSize = selectedPeople = null;
  renderCards(activities);
};

// ===== MODAL =====
closeModal.onclick = () => {
  modal.style.display = "none";
};

window.onclick = (event) => {
  if (event.target === modal) {
    modal.style.display = "none";
  }
};

function openModal(activity) {
  modalBody.innerHTML = `
    <h2>${activity.title}</h2>
    <p><span class="label">Material:</span> ${activity.material.join(", ")}</p>
    <p><span class="label">Edad:</span> ${activity.ages.join(", ")}</p>
    <p><span class="label">Duración:</span> ${activity.duration} min</p>
    <p><span class="label">Personas:</span> ${activity.people}</p>
    <p><span class="label">Máx. alumnos:</span> ${activity.maxStudents}</p>
    <p><span class="label">Tiempo mínimo visita:</span> ${activity.visit}</p>
    <hr style="margin: 20px 0; border: 0; border-top: 1px solid #eee;">
    <div style="line-height: 1.6;">${activity.fullDescription.replace(/\n/g, "<br>")}</div>
  `;
  modal.style.display = "flex";
}

// ===== RENDER =====

function renderCards(list) {
  cardsContainer.innerHTML = "";
  if (!list.length) {
    cardsContainer.innerHTML = "<p>No hay dinámicas que cumplan los filtros.</p>";
    return;
  }

  list.forEach(a => {
    const card = document.createElement("div");
    card.className = "card";
    card.innerHTML = `
      <h2>${a.title}</h2>
      <p><span class="label">Material:</span> ${a.material.join(", ")}</p>
      <p><span class="label">Edad:</span> ${a.ages.join(", ")}</p>
      <p><span class="label">Duración:</span> ${a.duration} min</p>
      <p><span class="label">Personas:</span> ${a.people}</p>
      <p><span class="label">Máx. alumnos:</span> ${a.maxStudents}</p>
      <p><span class="label">Tiempo mínimo visita:</span> ${a.visit}</p>
      <button class="more-info-btn">Más información</button>
    `;
    card.querySelector(".more-info-btn").onclick = () => openModal(a);
    cardsContainer.appendChild(card);
  });
}

// ===== FILTRADO =====

function applyFilters() {
  let result = activities.filter(a => {

    // Edad
    if (selectedAge !== null && !a.ages.includes(selectedAge)) {
      return false;
    }

    // Duración
    if (selectedTime !== null) {
      const dur = a.duration;
      const isShort = dur <= 3;
      const isMedium = dur >= 4 && dur <= 7;
      const isLong = dur >= 8;

      if (selectedTime === "short" && !isShort) return false;
      if (selectedTime === "medium" && !isMedium) return false;
      if (selectedTime === "long" && !isLong) return false;
    }

    // Alumnos
    if (selectedSize !== null && a.maxStudents > selectedSize) {
      return false;
    }

    // Feriantes
    if (selectedPeople !== null) {
      const hasOne = a.people.includes("1");
      const hasTwo = a.people.includes("2");
      if (selectedPeople === "1" && !hasOne) return false;
      if (selectedPeople === "2" && !hasTwo) return false;
    }

    return true;
  });

  renderCards(result);
}

// Inicial
renderCards(activities);